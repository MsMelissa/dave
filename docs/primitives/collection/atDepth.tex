\documentclass[../../main.tex]{subfiles}

\begin{document}

\subsubsection{At Depth}
The Primitive $atDepth$ will return the Value at a specified depth of indices within a passed in Collection.
The following helper Operation $getFirstIndex$ is introduced to establish navigation into a nested
Collection given a Collection of Indices.


\begin{schema}{GetFirstIndex[Collection, Collection]}
  coll?, idxs? : Collection \\
  v! : V \\
  getFirstIndex~\_ : Collection \cross Collection \surj V
  \where
  v! = getFirstIndex(coll?, idxs?) ~ @ ~ v! = atIndex(coll?, head(idxs?))
\end{schema}
This allows for the navigation into a nested Collection to be defined as
$\langle getFirstIndex~\_~, recur~\_ \rangle \bsup \#~ idxs? \esup$ which
represents a step down into $coll?$ for each member of $idxs?$. If there
is not a value at some specified index or navigation can't continue despite
what is being dictated by $idxs?$, the empty sequence $\langle  \rangle$ will be returned
\begin{schema}{AtDepth[Collection, Collection]}
  Recur, GetFirstIndex \\
  coll?, idxs? : Collection \\
  v! : V \\
  atDepth~\_ : Collection \cross Collection \surj V
  \where
  atDepth = \langle getFirstIndex~\_~, recur~\_ \rangle \bsup \#~ idxs? \esup \\
  v! = atDepth(coll?, idxs?) @ \\
  \t1 \forall n : i~..~j \in \dom idxs? @ j = first(last(idxs?)) \implies first(j, idxs?_{j}) ~|~ \exists_1 ~v_{n} @ \\
  \t2 let \ \ ~~ idxs_{n} == tail(idxs?)\bsup n - i \esup \\
  \t3 v_{i} == getFirstIndex(coll?, idxs_{n}) \\
  \t3 v_{n} == recur(v_{i}, idxs_{n}, getFirstIndex~\_)\bsup j \esup \\
  \t3 v_{j} == atIndex(v_{n}, last(idxs?)) \iff n = j-1 \\
  v! = v_{j} @ v_{j} : \seq_1 \iff (v_{n-1} = \seq_1 ~\land~ \\
  \t5 \ head(idxs_{n}) \mapsto v_{n} \in v_{n-i}) ~\lor \\
  \t2 v_{j} : \seq \iff v_{n-1} = \langle  \rangle \implies atIndex(v_{n-2}, head(idxs_{n-1})) = \langle  \rangle
\end{schema}
The following examples demonstrate the properties of $atDepth$ described above.
\begin{argue}
  X = \langle x_{0}, x_{1}, x_{2} \rangle \\
  \t1 x_{0} = 0 \\
  \t1 x_{1} = foo \\
  \t1 x_{2} = \langle a, b, c \rangle \\
  atDepth(X, \langle 1 \rangle) = foo \\
  atDepth(X, \langle 1, 0 \rangle) = f \implies foo = \langle f, o, o \rangle \\
  atDepth(X, \langle 2, 0 \rangle) = a \\
  atDepth(X, \langle 2, 5 \rangle) = \langle  \rangle
\end{argue}


\end{document}
