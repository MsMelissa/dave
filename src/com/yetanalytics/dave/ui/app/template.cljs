(ns com.yetanalytics.dave.ui.app.template)

(def queries
  {:query-1 "[:find ?x ?y ?c
  :where
  [?s :statement/timestamp ?t]
  [?s :statement.result.score/scaled ?y]
  [?s :statement/actor ?a]
  [?a :agent/mbox ?c]
  [->unix ?t ?x]]"
   :query-2 "[:find (count ?s) ?c
  :where
  [?s :statement/actor ?a]
  [?a :agent/mbox ?c]]"
   :query-3 "[:find ?c (count-distinct ?ac)
  :where
  [?a :agent/mbox ?c]
  [?ac :activity/id ?ac-id]
  [?s-suc :statement/actor ?a]
  [?s-suc :statement/object ?ac]
  [?s-suc :statement.result/success true]
  [?s-suc :statement/timestamp-inst ?s-suc-t]
  ;; fail
  [?s-f0 :statement/actor ?a]
  [?s-f0 :statement/object ?ac]
  [?s-f0 :statement.result/success false]
  [?s-f0 :statement/timestamp-inst ?s-f0-t]
  [(< ?s-f0-t ?s-suc-t)]]"
   :query-4 "[:find (count ?s) ?c
  :where
  [?s :statement/object ?o]
  [?o :activity.definition/name ?lmap]
  [?lmap :lmap/en-US ?c]]"
   :query-5 "[:find ?y ?c
  :where
  [?s :statement/object ?ac]
  [?ac :activity/id \"INSERT ACTIVITY HERE\"]
  [?s :statement.result.score/raw ?y]
  [?s :statement/actor ?a]
  [?a :agent/mbox ?c]]"
   :query-6 "[:find (avg ?y) ?c
  :where
  [?s :statement/object ?ac]
  [?s :statement.result.score/scaled ?y]
  [?s :statement/actor ?a]
  [?a :agent/mbox ?c]]"
   :query-7 "[:find ?h ?y
  :where
  [?s :statement/timestamp ?t]
  [time-format \"H\" ?t ?h]
  [?s :statement.result.score/scaled ?y]]"})

(def visualizations
  {:viz-1 "{\n  \"autosize\": \"fit\",\n  \"legends\": [\n    {\n      \"fill\": \"color\"\n    }\n  ],\n  \"axes\": [\n    {\n      \"orient\": \"bottom\",\n      \"scale\": \"x\",\n      \"labelAngle\": 60,\n      \"labelAlign\": \"left\",\n      \"labelLimit\": 112,\n      \"labelOverlap\": true,\n      \"labelSeparation\": -35\n    },\n    {\n      \"orient\": \"left\",\n      \"scale\": \"y\"\n    }\n  ],\n  \"width\": 500,\n  \"scales\": [\n    {\n      \"name\": \"x\",\n      \"type\": \"time\",\n      \"range\": \"width\",\n      \"domain\": {\n        \"data\": \"result\",\n        \"field\": \"?x\"\n      }\n    },\n    {\n      \"name\": \"y\",\n      \"type\": \"linear\",\n      \"range\": \"height\",\n      \"nice\": true,\n      \"zero\": true,\n      \"domain\": {\n        \"data\": \"result\",\n        \"field\": \"?y\"\n      }\n    },\n    {\n      \"name\": \"color\",\n      \"type\": \"ordinal\",\n      \"range\": \"category\",\n      \"domain\": {\n        \"data\": \"result\",\n        \"field\": \"?c\"\n      }\n    }\n  ],\n  \"padding\": 5,\n  \"marks\": [\n    {\n      \"type\": \"group\",\n      \"from\": {\n        \"facet\": {\n          \"name\": \"series\",\n          \"data\": \"result\",\n          \"groupby\": \"?c\"\n        }\n      },\n      \"marks\": [\n        {\n          \"type\": \"symbol\",\n          \"from\": {\n            \"data\": \"series\"\n          },\n          \"encode\": {\n            \"enter\": {\n              \"size\": {\n                \"value\": 50\n              },\n              \"x\": {\n                \"scale\": \"x\",\n                \"field\": \"?x\"\n              },\n              \"y\": {\n                \"scale\": \"y\",\n                \"field\": \"?y\"\n              },\n              \"fill\": {\n                \"scale\": \"color\",\n                \"field\": \"?c\"\n              }\n            }\n          }\n        }\n      ]\n    }\n  ],\n  \"$schema\": \"https://vega.github.io/schema/vega/v4.json\",\n  \"signals\": [\n    {\n      \"name\": \"interpolate\",\n      \"value\": \"linear\"\n    }\n  ],\n  \"height\": 200\n}\n"
   :viz-2 "{\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 400,\n  \"height\": 200,\n  \"padding\": 5,\n\n  \"data\": [\n    {      \n      \"name\": \"table\",\n      \"source\": \"result\",\n      \"transform\": [\n        { \"type\": \"collect\", \"sort\": {\"field\": \"count_?s\", \"order\" : \"descending\"} },\n        {\n          \"type\": \"window\",\n          \"sort\": {\"field\": \"count_?s\", \"order\": \"descending\"},\n          \"ops\": [\"rank\"],\n          \"fields\": [null],\n          \"as\": [\"rank\"]\n        },\n        \n        { \"type\": \"filter\", \"expr\": \"datum.rank < 11\"}\n      ]\n    }\n  ],\n\n  \"signals\": [\n    {\n      \"name\": \"tooltip\",\n      \"value\": {},\n      \"on\": [\n        {\"events\": \"rect:mouseover\", \"update\": \"datum\"},\n        {\"events\": \"rect:mouseout\",  \"update\": \"{}\"}\n      ]\n    }\n  ],\n\n  \"scales\": [\n    {\n      \"name\": \"xscale\",\n      \"type\": \"band\",\n      \"domain\": {\"data\": \"table\", \"field\": \"?c\"},\n      \"range\": \"width\",\n      \"padding\": 0.05,\n      \"round\": true\n    },\n    {\n      \"name\": \"yscale\",\n      \"domain\": {\"data\": \"table\", \"field\": \"count_?s\"},\n      \"nice\": true,\n      \"range\": \"height\"\n    }\n  ],\n\n  \"axes\": [\n    { \"orient\": \"bottom\", \"scale\": \"xscale\", \"labelAngle\": -35, \"zindex\": 2 },\n    { \"orient\": \"left\", \"scale\": \"yscale\" }\n  ],\n\n  \"marks\": [\n    {\n      \"type\": \"rect\",\n      \"from\": {\"data\":\"table\"},\n      \"encode\": {\n        \"enter\": {\n          \"x\": {\"scale\": \"xscale\", \"field\": \"?c\"},\n          \"width\": {\"scale\": \"xscale\", \"band\": 1},\n          \"y\": {\"scale\": \"yscale\", \"field\": \"count_?s\"},\n          \"y2\": {\"scale\": \"yscale\", \"value\": 0}\n        },\n        \"update\": {\n          \"fill\": {\"value\": \"steelblue\"}\n        },\n        \"hover\": {\n          \"fill\": {\"value\": \"red\"}\n        }\n      }\n    }\n  ]\n}"
   :viz-3 "{\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 400,\n  \"height\": 200,\n  \"padding\": 5,\n\n  \"data\": [\n    {      \n      \"name\": \"table\",\n      \"source\": \"result\",\n      \"transform\": [\n        { \"type\": \"collect\", \"sort\": {\"field\": \"count_?s\", \"order\" : \"ascending\"} },\n        {\n          \"type\": \"window\",\n          \"sort\": {\"field\": \"count_?s\", \"order\": \"ascending\"},\n          \"ops\": [\"rank\"],\n          \"fields\": [null],\n          \"as\": [\"rank\"]\n        },\n        \n        { \"type\": \"filter\", \"expr\": \"datum.rank < 11\"}\n      ]\n    }\n  ],\n\n  \"signals\": [\n    {\n      \"name\": \"tooltip\",\n      \"value\": {},\n      \"on\": [\n        {\"events\": \"rect:mouseover\", \"update\": \"datum\"},\n        {\"events\": \"rect:mouseout\",  \"update\": \"{}\"}\n      ]\n    }\n  ],\n\n  \"scales\": [\n    {\n      \"name\": \"xscale\",\n      \"type\": \"band\",\n      \"domain\": {\"data\": \"table\", \"field\": \"?c\"},\n      \"range\": \"width\",\n      \"padding\": 0.05,\n      \"round\": true\n    },\n    {\n      \"name\": \"yscale\",\n      \"domain\": {\"data\": \"table\", \"field\": \"count_?s\"},\n      \"nice\": true,\n      \"range\": \"height\"\n    }\n  ],\n\n  \"axes\": [\n    { \"orient\": \"bottom\", \"scale\": \"xscale\", \"labelAngle\": -35, \"zindex\": 2 },\n    { \"orient\": \"left\", \"scale\": \"yscale\" }\n  ],\n\n  \"marks\": [\n    {\n      \"type\": \"rect\",\n      \"from\": {\"data\":\"table\"},\n      \"encode\": {\n        \"enter\": {\n          \"x\": {\"scale\": \"xscale\", \"field\": \"?c\"},\n          \"width\": {\"scale\": \"xscale\", \"band\": 1},\n          \"y\": {\"scale\": \"yscale\", \"field\": \"count_?s\"},\n          \"y2\": {\"scale\": \"yscale\", \"value\": 0}\n        },\n        \"update\": {\n          \"fill\": {\"value\": \"steelblue\"}\n        },\n        \"hover\": {\n          \"fill\": {\"value\": \"red\"}\n        }\n      }\n    }\n  ]\n}"
   :viz-4 "{\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 400,\n  \"height\": 200,\n  \"padding\": 5,\n\n  \"data\": [\n    {      \n      \"name\": \"table\",\n      \"source\": \"result\",\n      \"transform\": [\n        { \"type\": \"collect\", \"sort\": {\"field\": \"count-distinct_?ac\", \"order\" : \"descending\" }},\n        {\n          \"type\": \"window\",\n          \"sort\": {\"field\": \"count-distinct_?ac\", \"order\": \"descending\"},\n          \"ops\": [\"rank\"],\n          \"fields\": [null],\n          \"as\": [\"rank\"]\n        },\n        \n        { \"type\": \"filter\", \"expr\": \"datum.rank < 15\"}\n      ]\n    }\n  ],\n\n  \"signals\": [\n    {\n      \"name\": \"tooltip\",\n      \"value\": {},\n      \"on\": [\n        {\"events\": \"rect:mouseover\", \"update\": \"datum\"},\n        {\"events\": \"rect:mouseout\",  \"update\": \"{}\"}\n      ]\n    }\n  ],\n\n  \"scales\": [\n    {\n      \"name\": \"xscale\",\n      \"type\": \"band\",\n      \"domain\": {\"data\": \"table\", \"field\": \"?c\"},\n      \"range\": \"width\",\n      \"padding\": 0.05,\n      \"round\": true\n    },\n    {\n      \"name\": \"yscale\",\n      \"domain\": {\"data\": \"table\", \"field\": \"count-distinct_?ac\"},\n      \"nice\": true,\n      \"range\": \"height\"\n    }\n  ],\n\n  \"axes\": [\n    { \"orient\": \"bottom\", \"scale\": \"xscale\", \"labelAngle\": -35, \"zindex\": 2 },\n    { \"orient\": \"left\", \"scale\": \"yscale\", \"tickMinStep\":1 }\n  ],\n\n  \"marks\": [\n    {\n      \"type\": \"rect\",\n      \"from\": {\"data\":\"table\"},\n      \"encode\": {\n        \"enter\": {\n          \"x\": {\"scale\": \"xscale\", \"field\": \"?c\"},\n          \"width\": {\"scale\": \"xscale\", \"band\": 1},\n          \"y\": {\"scale\": \"yscale\", \"field\": \"count-distinct_?ac\"},\n          \"y2\": {\"scale\": \"yscale\", \"value\": 0}\n        },\n        \"update\": {\n          \"fill\": {\"value\": \"steelblue\"}\n        },\n        \"hover\": {\n          \"fill\": {\"value\": \"red\"}\n        }\n      }\n    }\n  ]\n}"
   :viz-5 "{\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 400,\n  \"height\": 200,\n  \"padding\": 5,\n\n  \"data\": [\n    {      \n      \"name\": \"table\",\n      \"source\": \"result\",\n      \"transform\": [\n        { \"type\": \"collect\", \"sort\": {\"field\": \"?y\", \"order\":\"descending\"} },\n        {\n          \"type\": \"window\",\n          \"sort\": {\"field\": \"?y\", \"order\": \"descending\"},\n          \"ops\": [\"rank\"],\n          \"fields\": [null],\n          \"as\": [\"rank\"]\n        },\n        \n        { \"type\": \"filter\", \"expr\": \"datum.rank < 6\"}\n      ]\n    }\n  ],\n\n  \"signals\": [\n    {\n      \"name\": \"tooltip\",\n      \"value\": {},\n      \"on\": [\n        {\"events\": \"rect:mouseover\", \"update\": \"datum\"},\n        {\"events\": \"rect:mouseout\",  \"update\": \"{}\"}\n      ]\n    }\n  ],\n\n  \"scales\": [\n    {\n      \"name\": \"xscale\",\n      \"type\": \"band\",\n      \"domain\": {\"data\": \"table\", \"field\": \"?c\"},\n      \"range\": \"width\",\n      \"padding\": 0.05,\n      \"round\": true\n    },\n    {\n      \"name\": \"yscale\",\n      \"domain\": {\"data\": \"table\", \"field\": \"?y\"},\n      \"nice\": true,\n      \"range\": \"height\"\n    }\n  ],\n\n  \"axes\": [\n    { \"orient\": \"bottom\", \"scale\": \"xscale\", \"labelAngle\": -35, \"zindex\": 2 },\n    { \"orient\": \"left\", \"scale\": \"yscale\" }\n  ],\n\n  \"marks\": [\n    {\n      \"type\": \"rect\",\n      \"from\": {\"data\":\"table\"},\n      \"encode\": {\n        \"enter\": {\n          \"x\": {\"scale\": \"xscale\", \"field\": \"?c\"},\n          \"width\": {\"scale\": \"xscale\", \"band\": 1},\n          \"y\": {\"scale\": \"yscale\", \"field\": \"?y\"},\n          \"y2\": {\"scale\": \"yscale\", \"value\": 0}\n        },\n        \"update\": {\n          \"fill\": {\"value\": \"steelblue\"}\n        },\n        \"hover\": {\n          \"fill\": {\"value\": \"red\"}\n        }\n      }\n    }\n  ]\n}\n"
   :viz-6 "{\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 400,\n  \"height\": 200,\n  \"padding\": 5,\n\n  \"data\": [\n    {      \n      \"name\": \"table\",\n      \"source\": \"result\",\n      \"transform\": [\n        { \"type\": \"collect\", \"sort\": {\"field\": \"?y\", \"order\" : \"ascending\"} },\n        {\n          \"type\": \"window\",\n          \"sort\": {\"field\": \"?y\", \"order\": \"ascending\"},\n          \"ops\": [\"rank\"],\n          \"fields\": [null],\n          \"as\": [\"rank\"]\n        },\n        \n        { \"type\": \"filter\", \"expr\": \"datum.rank < 6\"}\n      ]\n    }\n  ],\n\n  \"signals\": [\n    {\n      \"name\": \"tooltip\",\n      \"value\": {},\n      \"on\": [\n        {\"events\": \"rect:mouseover\", \"update\": \"datum\"},\n        {\"events\": \"rect:mouseout\",  \"update\": \"{}\"}\n      ]\n    }\n  ],\n\n  \"scales\": [\n    {\n      \"name\": \"xscale\",\n      \"type\": \"band\",\n      \"domain\": {\"data\": \"table\", \"field\": \"?c\"},\n      \"range\": \"width\",\n      \"padding\": 0.05,\n      \"round\": true\n    },\n    {\n      \"name\": \"yscale\",\n      \"domain\": {\"data\": \"table\", \"field\": \"?y\"},\n      \"nice\": true,\n      \"range\": \"height\"\n    }\n  ],\n\n  \"axes\": [\n    { \"orient\": \"bottom\", \"scale\": \"xscale\", \"labelAngle\": -35, \"zindex\": 2 },\n    { \"orient\": \"left\", \"scale\": \"yscale\" }\n  ],\n\n  \"marks\": [\n    {\n      \"type\": \"rect\",\n      \"from\": {\"data\":\"table\"},\n      \"encode\": {\n        \"enter\": {\n          \"x\": {\"scale\": \"xscale\", \"field\": \"?c\"},\n          \"width\": {\"scale\": \"xscale\", \"band\": 1},\n          \"y\": {\"scale\": \"yscale\", \"field\": \"?y\"},\n          \"y2\": {\"scale\": \"yscale\", \"value\": 0}\n        },\n        \"update\": {\n          \"fill\": {\"value\": \"steelblue\"}\n        },\n        \"hover\": {\n          \"fill\": {\"value\": \"red\"}\n        }\n      }\n    }\n  ]\n}"
   :viz-7 "{\n  \"$schema\": \"https://vega.github.io/schema/vega/v5.json\",\n  \"width\": 400,\n  \"height\": 200,\n  \"padding\": 5,\n\n  \"data\": [\n    {      \n      \"name\": \"table\",\n      \"source\": \"result\",\n      \"transform\": [\n        { \"type\": \"collect\", \"sort\": {\"field\": \"avg_?y\", \"order\": \"descending\"} },\n        {\n          \"type\": \"window\",\n          \"sort\": {\"field\": \"avg_?y\", \"order\": \"descending\"},\n          \"ops\": [\"rank\"],\n          \"fields\": [null],\n          \"as\": [\"rank\"]\n        },\n        \n        { \"type\": \"filter\", \"expr\": \"datum.rank < 10\"}\n      ]\n    }\n  ],\n  \"signals\": [\n    {\n      \"name\": \"tooltip\",\n      \"value\": {},\n      \"on\": [\n        {\"events\": \"rect:mouseover\", \"update\": \"datum\"},\n        {\"events\": \"rect:mouseout\",  \"update\": \"{}\"}\n      ]\n    }\n  ],\n\n  \"scales\": [\n    {\n      \"name\": \"xscale\",\n      \"type\": \"band\",\n      \"domain\": {\"data\": \"table\", \"field\": \"?c\"},\n      \"range\": \"width\",\n      \"padding\": 0.05,\n      \"round\": true\n    },\n    {\n      \"name\": \"yscale\",\n      \"domain\": {\"data\": \"table\", \"field\": \"avg_?y\"},\n      \"nice\": true,\n      \"range\": \"height\"\n    }\n  ],\n\n  \"axes\": [\n    { \"orient\": \"bottom\", \"scale\": \"xscale\", \"labelAngle\": -35, \"zindex\": 2 },\n    { \"orient\": \"left\", \"scale\": \"yscale\" }\n  ],\n\n  \"marks\": [\n    {\n      \"type\": \"rect\",\n      \"from\": {\"data\":\"table\"},\n      \"encode\": {\n        \"enter\": {\n          \"x\": {\"scale\": \"xscale\", \"field\": \"?c\"},\n          \"width\": {\"scale\": \"xscale\", \"band\": 1},\n          \"y\": {\"scale\": \"yscale\", \"field\": \"avg_?y\"},\n          \"y2\": {\"scale\": \"yscale\", \"value\": 0}\n        },\n        \"update\": {\n          \"fill\": {\"value\": \"steelblue\"}\n        },\n        \"hover\": {\n          \"fill\": {\"value\": \"red\"}\n        }\n      }\n    }\n  ]\n}"
   :viz-8 "{\n  \"autosize\": \"fit\",\n  \"data\": [\n    {\n      \"name\": \"cleaned\",\n      \"source\": \"result\",\n      \"transform\": [\n        {\"type\": \"project\", \"fields\": [\"?h\", \"?y\"], \"as\": [\"hourString\", \"score\"]},\n        { \"type\": \"formula\", \"as\": \"hour\", \"expr\": \"toNumber(datum.hourString)\"}\n      ]\n    },\n    {\n      \"name\": \"trend\",\n      \"source\": \"cleaned\",\n      \"transform\": [\n        {\n          \"type\": \"regression\",\n          \"method\": \"linear\",\n          \"order\": 3,\n          \"extent\": [0, 23],\n          \"x\": \"hour\",\n          \"y\": \"score\",\n          \"as\": [\"u\", \"v\"]\n        }\n      ]\n    }\n    ],\n  \"axes\": [\n    {\n      \"orient\": \"bottom\",\n      \"scale\": \"x\",\n      \"labelAngle\": 60,\n      \"labelAlign\": \"left\"\n    },\n    {\n      \"orient\": \"left\",\n      \"scale\": \"y\"\n    }\n  ],\n  \"width\": 500,\n  \"scales\": [\n    {\n      \"name\": \"x\",\n      \"range\": \"width\",\n      \"domain\": {\n        \"data\": \"cleaned\",\n        \"field\": \"hour\"\n      }\n    },\n    {\n      \"name\": \"y\",\n      \"type\": \"linear\",\n      \"range\": \"height\",\n      \"nice\": true,\n      \"zero\": true,\n      \"domain\": {\n        \"data\": \"cleaned\",\n        \"field\": \"score\"\n      }\n    },\n    {\n      \"name\": \"color\",\n      \"type\": \"ordinal\",\n      \"range\": \"category\",\n      \"domain\": {\n        \"data\": \"cleaned\",\n        \"field\": \"?c\"\n      }\n    }\n  ],\n  \"padding\": 5,\n  \"marks\": [\n    {\n      \"type\": \"group\",\n      \"from\": {\n        \"facet\": {\n          \"name\": \"series\",\n          \"data\": \"cleaned\",\n          \"groupby\": \"?c\"\n        }\n      },\n      \"marks\": [\n        {\n          \"type\": \"symbol\",\n          \"from\": {\n            \"data\": \"series\"\n          },\n          \"encode\": {\n            \"enter\": {\n              \"size\": {\n                \"value\": 50\n              },\n              \"x\": {\n                \"scale\": \"x\",\n                \"field\": \"hour\"\n              },\n              \"y\": {\n                \"scale\": \"y\",\n                \"field\": \"score\"\n              },\n              \"fill\": {\n                \"scale\": \"color\",\n                \"field\": \"?c\"\n              }\n            }\n          }\n        }\n      ]\n    },\n    {\n      \"type\": \"group\",\n      \"from\": {\n        \"facet\": {\n          \"data\": \"trend\",\n          \"name\": \"curve\",\n          \"groupby\": \"hour\"\n        }\n      },\n      \"marks\": [\n        {\n          \"type\": \"line\",\n          \"from\": {\"data\": \"curve\"},\n          \"encode\": {\n            \"enter\": {\n              \"x\": {\"scale\": \"x\", \"field\": \"u\"},\n              \"y\": {\"scale\": \"y\", \"field\": \"v\"},\n              \"stroke\": {\"value\": \"firebrick\"}\n            }\n          }\n        }\n      ]\n    }\n  ],\n  \"$schema\": \"https://vega.github.io/schema/vega/v4.json\",\n  \"signals\": [\n    {\n      \"name\": \"interpolate\",\n      \"value\": \"linear\"\n    }\n  ],\n  \"height\": 200\n}"})
